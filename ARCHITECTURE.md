# CFB Mismatch Model - Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          CFB MISMATCH MODEL                             │
│                     College Football Analytics Package                  │
└─────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────┐
│  USER INTERACTION                                                         │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  CLI Command:                      Programmatic API:                     │
│  ┌────────────────────┐           ┌──────────────────────┐              │
│  │ cfb-mismatch week  │           │ from cfb_mismatch    │              │
│  │  --year 2025       │           │ import build_week    │              │
│  │  --week 7          │           │                      │              │
│  │  --output-dir out/ │           │ build_week(2025, 7)  │              │
│  └────────────────────┘           └──────────────────────┘              │
│           │                                   │                          │
└───────────┼───────────────────────────────────┼──────────────────────────┘
            │                                   │
            └───────────────┬───────────────────┘
                            ▼
┌───────────────────────────────────────────────────────────────────────────┐
│  CORE PIPELINE (main.py)                                                  │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │ 1. Load Configuration (settings.yaml, weights.yaml)             │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                            ▼                                              │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │ 2. Fetch CFBD Data (games, team stats, advanced metrics)        │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                            ▼                                              │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │ 3. Compute Base Mismatches (EPA, success rate, explosiveness)   │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                            ▼                                              │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │ 4. Add Extended Features (if enabled)                           │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                            ▼                                              │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │ 5. Generate Output CSVs (run, pass, pass protection)            │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────┐
│  DATA SOURCES                                                             │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐       │
│  │  CFBD API        │  │  PFF CSVs        │  │ FantasyPoints    │       │
│  │  (Required)      │  │  (Optional)      │  │ CSVs (Optional)  │       │
│  ├──────────────────┤  ├──────────────────┤  ├──────────────────┤       │
│  │ • Team Stats     │  │ • OL/DL Rates    │  │ • Receiver Splits│       │
│  │ • Games          │  │ • Def Fronts     │  │ • Man vs Zone    │       │
│  │ • EPA Metrics    │  │ • Coverage       │  │ • Target Share   │       │
│  │ • Success Rates  │  │ • Run Concepts   │  │ • Slot Rates     │       │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘       │
│           │                      │                      │                │
│           └──────────────────────┴──────────────────────┘                │
│                                  ▼                                        │
└───────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────┐
│  DATA ADAPTERS (adapters/)                                                │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  pff.py                    fantasypoints.py                               │
│  ┌───────────────────┐    ┌─────────────────────┐                        │
│  │ load_ol_dl_data() │    │ load_receiver_splits│                        │
│  │ load_def_front()  │    │ aggregate_team_data │                        │
│  │ load_run_concepts │    └─────────────────────┘                        │
│  └───────────────────┘                                                    │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────┐
│  FEATURE COMPUTATION (ext_features.py)                                    │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌────────────────────────────────────────────────────────────────┐     │
│  │ PFF Features:                                                  │     │
│  │ • OL/DL matchup advantages                                     │     │
│  │ • Run concept fit index                                        │     │
│  │ • Coverage shell advantages                                    │     │
│  └────────────────────────────────────────────────────────────────┘     │
│                                                                           │
│  ┌────────────────────────────────────────────────────────────────┐     │
│  │ FantasyPoints Features:                                        │     │
│  │ • Route-family fit scores                                      │     │
│  │ • Man/zone coverage matchups                                   │     │
│  │ • Target distribution efficiency                               │     │
│  └────────────────────────────────────────────────────────────────┘     │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────┐
│  OUTPUT FILES (data/out/)                                                 │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  ┌─────────────────────────────────────────────────────────────┐         │
│  │ cfb_unit_mismatches_week<N>.csv                             │         │
│  │ ─────────────────────────────────────────────────────────── │         │
│  │ Complete matchup data with all mismatch scores              │         │
│  └─────────────────────────────────────────────────────────────┘         │
│                                                                           │
│  ┌─────────────────────────────────────────────────────────────┐         │
│  │ top_run_mismatches.csv                                      │         │
│  │ ─────────────────────────────────────────────────────────── │         │
│  │ Top 20 run game mismatches (offense vs defense)             │         │
│  └─────────────────────────────────────────────────────────────┘         │
│                                                                           │
│  ┌─────────────────────────────────────────────────────────────┐         │
│  │ top_pass_mismatches.csv                                     │         │
│  │ ─────────────────────────────────────────────────────────── │         │
│  │ Top 20 passing game mismatches (QB/WR vs coverage)          │         │
│  └─────────────────────────────────────────────────────────────┘         │
│                                                                           │
│  ┌─────────────────────────────────────────────────────────────┐         │
│  │ top_passpro_mismatches.csv                                  │         │
│  │ ─────────────────────────────────────────────────────────── │         │
│  │ Top 20 pass protection mismatches (OL vs DL)                │         │
│  └─────────────────────────────────────────────────────────────┘         │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────┐
│  CONFIGURATION (configs/)                                                 │
├───────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  settings.yaml           weights.yaml                                     │
│  ┌──────────────────┐   ┌────────────────────────┐                       │
│  │ use_pff: false   │   │ base_weights:          │                       │
│  │ use_fp: false    │   │   run_epa: 0.30        │                       │
│  │ output_dir: ...  │   │   pass_epa: 0.30       │                       │
│  │ top_n: 20        │   │ pff_weights: ...       │                       │
│  └──────────────────┘   │ fp_weights: ...        │                       │
│                         │ composite_weights: ... │                       │
│                         └────────────────────────┘                       │
│                                                                           │
└───────────────────────────────────────────────────────────────────────────┘

WORKFLOW:
─────────
1. User runs CLI command or calls Python function
2. Pipeline loads configuration and connects to CFBD
3. Fetches game schedule and team statistics
4. Computes base mismatch scores using EPA and efficiency metrics
5. Optionally enhances with PFF and FantasyPoints data
6. Applies configurable weights to generate final scores
7. Outputs multiple CSV files with top mismatches
